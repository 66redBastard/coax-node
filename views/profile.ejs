<%- include('partials/header'); -%>

	<main class="mx-auto mt-5" style="width: 420px">
		<div class="headings d-flex justify-content-between ">
			<h2>
				Profile
			</h2>

			<nav>
				<!-- <a id="myContactsRoute" class="btn btn-outline-dark"
					href="/contacts">Contacts</a> -->
				<a id="myFilesRoute" class="btn btn-dark" href="/library">View my
					files</a>
			</nav>
		</div>

		<h3 class="mt-5">Update Profile Email</h3>
		<form method="put" class="mt-3 mb-3">
			<div class="mb-3 mt-3">
				<input type="first_name" id="oldFirstName" name="oldFirstName"
					class="form-control" value="<%= collectionUser.first_name %>" />
			</div>
			<div class="mb-3 mt-3">
				<input type="last_name" id="oldLastName" name="oldLastName"
					class="form-control" value="<%= collectionUser.last_name %>" />
			</div>
			<div class="mb-3 mt-3">
				<input type="email" id="oldEmail" name="oldEmail" class="form-control"
					value="<%= collectionUser.email %>" />
			</div>
			<div class="mb-3">
				<input id="userId" name="userId" class="form-control"
					value="<%= collectionUser._id %>" readonly="readonly" />
			</div>
			<button class="btn btn-outline-primary mt-3"
				onclick="updateData()">Update</button>
		</form>

		<h3 class="mt-5">Upload File</h3>
		<form id="uploadForm" class="form-contaier" method="post"
			enctype="multipart/form-data" action="/uploadFile">
			<div class="mb-3">
				<label for="formFile" class="form-label">Default file input
					example</label>
				<input id="formFile" class="form-control" type="file" name="uploadFile">
			</div>
			<!-- <div class="mb-3">
				<label for="formFileMultiple" class="form-label">Multiple files input
					example</label>
				<input class="form-control" type="file" id="formFileMultiple"
					name="myFiles" multiple>
			</div> -->
			<button type="submit" class="btn btn-outline-primary mt-1">Submit</button>
		</form>

		<h3 class="mt-5">Invite Some Dude</h3>
		<form id="formInvite">
			<div class="mb-3">
				<label for="emailAdress" class="form-label">Email
					address</label>
				<input type="email" class="form-control" id="emailAdress"
					placeholder="name@example.com">
				<div class="sendEmail error"></div>
			</div>
			<div class="mb-3">
				<label for="userMessage" class="form-label">Your
					message</label>
				<textarea type="textarea" class="form-control" id="userMessage"
					rows="3"></textarea>
			</div>
			<button type="submit" class="btn btn-outline-primary">Invite</button>
		</form>

		<script>

			const updateData = async () => {
				const userId = document.getElementById("userId").value;
				const userFirstName = document.getElementById("oldFirstName").value;
				const userLastName = document.getElementById("oldLastName").value;
				const userNewEmail = document.getElementById("oldEmail").value;
				const result = await fetch('/signup', {
					method: 'PUT',
					body: JSON.stringify({
						user_id: userId,
						first_name: userFirstName,
						last_name: userLastName,
						email: userNewEmail
					}),
					headers: { 'Content-Type': 'application/json' }
				});
				console.log(result)
			}

			const emailForm = document.querySelector('#formInvite');
			const emailError = document.querySelector('.sendEmail.error');
			const textAreaValue = document.querySelector('#userMessage');
			const emailValue = document.querySelector('#emailAdress');

			// const libraryRoute = document.querySelector('#myFilesRoute')

			// libraryRoute.addEventListener('click', async (e) => {
			// 	await fetch('/library')
			// }, false);

			emailForm.addEventListener('submit', async (e) => {
				e.preventDefault();

				// get values
				console.log(emailValue.value)
				console.log(textAreaValue.value)

				const email = emailValue.value;
				const userMessage = textAreaValue.value;

				try {
					const res = await fetch('/send', {
						method: 'POST',
						body: JSON.stringify({ email: email, message: userMessage }),
						headers: {
							'content-length': '288',
							'content-type': 'application/json; charset=UTF-8',
						}
					});
					// PROBLEM: cant get respons from mail
					// const data = await res.json();
					// console.log(data);
					// if (data.errors) {
					// 	emailError.textContent = data.errors.email;
					// }
					// location.assign('/ggg');
				}
				catch (err) {
					console.log(err);
				}
			});
		</script>



	</main>


	<%- include('partials/footer'); -%>